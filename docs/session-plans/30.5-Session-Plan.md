# Session 30.5: Pages + Layout

**Parent Plan**: `30-Session-Plan.md`
**Target**: ~40k tokens
**Prerequisites**: Session 30.4 complete (WorkItemDialog and Kanban components working)

---

## Scope

This session implements the WASM host pages, layout components, and final integration:

1. **Layout Components** - Navigation menu and main layout structure
2. **Home Page** - Dashboard with project listing and stats
3. **ProjectDetail Page** - Project view with list/board toggle
4. **WorkItemDetail Page** - Work item detail view with children
5. **Integration** - Wire up routing, imports, and services

---

## Implementation Order

### Step 1: Create NavMenu Component

**Create**: `ProjectManagement.Wasm/Layout/NavMenu.razor`

```razor
@using ProjectManagement.Core.Models
@inject AppState AppState
@inject NavigationManager NavigationManager
@implements IDisposable

<nav class="rz-sidebar" aria-label="Main navigation">
    <RadzenPanelMenu>
        <RadzenPanelMenuItem Text="Home" Icon="home" Path="" />

        @if (_recentProjects.Any())
        {
            <RadzenPanelMenuItem Text="Recent Projects" Icon="folder" Expanded="true">
                @foreach (var project in _recentProjects)
                {
                    <RadzenPanelMenuItem Text="@project.Title"
                                         Icon="folder_open"
                                         Path="@($"project/{project.Id}")" />
                }
            </RadzenPanelMenuItem>
        }

        <RadzenPanelMenuItem Text="All Projects" Icon="list" Path="projects" />
    </RadzenPanelMenu>
</nav>

@code {
    private List<WorkItem> _recentProjects = new();

    protected override void OnInitialized()
    {
        AppState.OnStateChanged += HandleStateChanged;
        RefreshProjects();
    }

    private void RefreshProjects()
    {
        // Get projects - these are WorkItems with ItemType.Project
        // Since projects don't have a parent ProjectId pointing to themselves,
        // we need to query all work items and filter by type
        try
        {
            // Get all loaded work items from the store and filter to projects
            // Note: In a real scenario, we'd have a dedicated GetProjects() method
            // For now, we'll check if any projects are loaded
            _recentProjects = new List<WorkItem>();

            // Try to get projects from the store
            // Projects are top-level items with ItemType.Project
            // We'd typically have them loaded when viewing a project
        }
        catch
        {
            _recentProjects = new List<WorkItem>();
        }
    }

    private void HandleStateChanged()
    {
        RefreshProjects();
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        AppState.OnStateChanged -= HandleStateChanged;
    }
}
```

**Purpose**: Side navigation menu that displays recent projects and navigation links. Subscribes to AppState to refresh when projects are loaded.

---

### Step 2: Create MainLayout Component

**Create**: `ProjectManagement.Wasm/Layout/MainLayout.razor`

```razor
@inherits LayoutComponentBase
@using Radzen
@using Radzen.Blazor
@using ProjectManagement.Wasm.Shared
@using ProjectManagement.Components.Shared

<RadzenLayout>
    <RadzenHeader>
        <RadzenStack Orientation="Orientation.Horizontal"
                     AlignItems="AlignItems.Center"
                     JustifyContent="JustifyContent.SpaceBetween"
                     Gap="1rem"
                     class="px-4 w-100"
                     Style="height: 100%;">
            <RadzenStack Orientation="Orientation.Horizontal"
                         AlignItems="AlignItems.Center"
                         Gap="0.75rem">
                <RadzenIcon Icon="dashboard" Style="font-size: 1.5rem;" />
                <RadzenText TextStyle="TextStyle.H5" class="m-0">
                    Agile Board
                </RadzenText>
            </RadzenStack>
            <ConnectionStatus />
        </RadzenStack>
    </RadzenHeader>

    <RadzenSidebar Style="width: 250px;">
        <NavMenu />
    </RadzenSidebar>

    <RadzenBody>
        <OfflineBanner />
        <div class="rz-p-4">
            <AppErrorBoundary>
                @Body
            </AppErrorBoundary>
        </div>
    </RadzenBody>
</RadzenLayout>

<RadzenDialog />
<RadzenNotification Position="NotificationPosition.TopRight" />
<RadzenContextMenu />
<RadzenTooltip />
```

**Purpose**: Main application layout with header, sidebar navigation, and body. Includes Radzen service components (Dialog, Notification, etc.) and error boundary.

---

### Step 3: Create Home Page

**Create**: `ProjectManagement.Wasm/Pages/Home.razor`

```razor
@page "/"
@using ProjectManagement.Core.Models
@using ProjectManagement.Core.ViewModels
@inject AppState AppState
@inject ViewModelFactory ViewModelFactory
@inject DialogService DialogService
@inject NavigationManager NavigationManager
@implements IDisposable

<PageTitle>Home - Agile Board</PageTitle>

<div class="page-header">
    <div>
        <h1 class="page-title">Welcome to Agile Board</h1>
        <p class="page-subtitle">Manage your projects and track work items</p>
    </div>
</div>

@if (_loading)
{
    <ProjectDetailSkeleton RowCount="3" />
}
else if (!_projects.Any())
{
    <EmptyState Icon="rocket_launch"
                Title="Get Started"
                Description="Create your first project to begin organizing your work."
                ActionText="Create Project"
                OnAction="@ShowCreateProjectDialog" />
}
else
{
    <RadzenStack Gap="1.5rem">
        @* Quick Stats *@
        <RadzenRow Gap="1rem">
            <RadzenColumn Size="12" SizeSM="6" SizeMD="3">
                <div class="stat-card">
                    <div class="stat-card-value">@_projects.Count</div>
                    <div class="stat-card-label">Projects</div>
                </div>
            </RadzenColumn>
            <RadzenColumn Size="12" SizeSM="6" SizeMD="3">
                <div class="stat-card">
                    <div class="stat-card-value">@_activeItems</div>
                    <div class="stat-card-label">Active Items</div>
                </div>
            </RadzenColumn>
            <RadzenColumn Size="12" SizeSM="6" SizeMD="3">
                <div class="stat-card">
                    <div class="stat-card-value">@_completedToday</div>
                    <div class="stat-card-label">Completed Today</div>
                </div>
            </RadzenColumn>
            <RadzenColumn Size="12" SizeSM="6" SizeMD="3">
                <div class="stat-card">
                    <div class="stat-card-value">@_activeSprints</div>
                    <div class="stat-card-label">Active Sprints</div>
                </div>
            </RadzenColumn>
        </RadzenRow>

        @* Recent Projects *@
        <div class="content-card">
            <div class="content-card-header">
                <h2 class="content-card-title">Recent Projects</h2>
                <LoadingButton Text="New Project"
                               Icon="add"
                               ConnectionState="@_connectionState"
                               OnClick="@ShowCreateProjectDialog" />
            </div>

            <RadzenDataList Data="@_projects" TItem="WorkItemViewModel">
                <Template Context="project">
                    <RadzenStack Orientation="Orientation.Horizontal"
                                 AlignItems="AlignItems.Center"
                                 JustifyContent="JustifyContent.SpaceBetween"
                                 class="p-3"
                                 Style="border-bottom: 1px solid var(--rz-border-color); cursor: pointer;"
                                 @onclick="@(() => NavigateToProject(project))">
                        <RadzenStack Orientation="Orientation.Horizontal"
                                     AlignItems="AlignItems.Center"
                                     Gap="0.75rem">
                            <WorkItemTypeIcon Type="WorkItemType.Project" Size="1.25rem" />
                            <div>
                                <RadzenText TextStyle="TextStyle.Body1" class="m-0">
                                    @project.Title
                                </RadzenText>
                                @if (!string.IsNullOrEmpty(project.Description))
                                {
                                    <RadzenText TextStyle="TextStyle.Caption" class="text-muted m-0 text-truncate" Style="max-width: 400px;">
                                        @project.Description
                                    </RadzenText>
                                }
                            </div>
                        </RadzenStack>
                        <RadzenIcon Icon="chevron_right" class="text-muted" />
                    </RadzenStack>
                </Template>
            </RadzenDataList>
        </div>
    </RadzenStack>
}

@code {
    private List<WorkItemViewModel> _projects = new();
    private bool _loading = true;
    private ConnectionState _connectionState = ConnectionState.Connected;

    // Stats
    private int _activeItems;
    private int _completedToday;
    private int _activeSprints;

    protected override async Task OnInitializedAsync()
    {
        _connectionState = AppState.ConnectionState;
        AppState.OnStateChanged += HandleStateChanged;
        AppState.OnConnectionStateChanged += HandleConnectionChanged;

        await LoadDataAsync();
    }

    private async Task LoadDataAsync()
    {
        _loading = true;
        StateHasChanged();

        try
        {
            await Task.Yield();

            // In a real app, we'd load projects from a dedicated API
            // For now, we look for work items with ItemType.Project
            // This would typically be handled by a ProjectStore
            _projects = new List<WorkItemViewModel>();

            // Calculate stats from loaded data
            // _activeItems = work items in progress
            // _completedToday = work items completed today
            // _activeSprints = sprints with Active status

            _activeItems = 0;
            _completedToday = 0;
            _activeSprints = 0;
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }

    private void NavigateToProject(WorkItemViewModel project)
    {
        NavigationManager.NavigateTo($"/project/{project.Id}");
    }

    private async Task ShowCreateProjectDialog()
    {
        var result = await DialogService.OpenAsync<WorkItemDialog>(
            "Create Project",
            new Dictionary<string, object>
            {
                { "DefaultItemType", WorkItemType.Project },
                { "ProjectId", Guid.Empty } // Projects don't have a parent project
            },
            new DialogOptions { Width = "600px" });

        if (result is true)
        {
            await LoadDataAsync();
        }
    }

    private void HandleStateChanged()
    {
        _ = LoadDataAsync();
    }

    private void HandleConnectionChanged(ConnectionState state)
    {
        _connectionState = state;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        AppState.OnStateChanged -= HandleStateChanged;
        AppState.OnConnectionStateChanged -= HandleConnectionChanged;
    }
}
```

**Purpose**: Home page dashboard showing quick stats and recent projects. Empty state for first-time users. Uses ProjectDetailSkeleton for loading state.

---

### Step 4: Create ProjectDetail Page

**Create**: `ProjectManagement.Wasm/Pages/ProjectDetail.razor`

```razor
@page "/project/{ProjectId:guid}"
@using ProjectManagement.Core.Models
@using ProjectManagement.Core.ViewModels
@inject AppState AppState
@inject ViewModelFactory ViewModelFactory
@inject DialogService DialogService
@inject NotificationService NotificationService
@inject NavigationManager NavigationManager
@implements IDisposable

<PageTitle>@(_project?.Title ?? "Project") - Agile Board</PageTitle>

@if (_loading)
{
    <ProjectDetailSkeleton />
}
else if (_project is null)
{
    <EmptyState Icon="error"
                Title="Project Not Found"
                Description="The project you're looking for doesn't exist or has been deleted."
                ActionText="Go Home"
                OnAction="@(() => NavigationManager.NavigateTo("/"))" />
}
else
{
    @* Breadcrumbs *@
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span class="separator">/</span>
        <span class="current">@_project.Title</span>
    </nav>

    @* Header *@
    <div class="page-header">
        <RadzenStack Orientation="Orientation.Horizontal"
                     AlignItems="AlignItems.Center"
                     Gap="0.75rem">
            <WorkItemTypeIcon Type="WorkItemType.Project" Size="1.75rem" />
            <div>
                <h1 class="page-title">@_project.Title</h1>
                @if (!string.IsNullOrEmpty(_project.Description))
                {
                    <p class="page-subtitle">@_project.Description</p>
                }
            </div>
        </RadzenStack>
        <div class="page-actions">
            <LoadingButton Text="New Work Item"
                           Icon="add"
                           ConnectionState="@_connectionState"
                           OnClick="@ShowCreateDialog" />
        </div>
    </div>

    @* View Tabs *@
    <div class="view-tabs">
        <button class="view-tab @(_activeView == "list" ? "active" : "")"
                @onclick="@(() => _activeView = "list")">
            <RadzenIcon Icon="list" />
            List
        </button>
        <button class="view-tab @(_activeView == "board" ? "active" : "")"
                @onclick="@(() => _activeView = "board")">
            <RadzenIcon Icon="view_kanban" />
            Board
        </button>
    </div>

    @* Content *@
    @if (_activeView == "list")
    {
        <WorkItemList ProjectId="@ProjectId"
                      OnWorkItemSelected="@HandleWorkItemSelected" />
    }
    else
    {
        <KanbanBoard ProjectId="@ProjectId"
                     OnWorkItemSelected="@HandleWorkItemSelected" />
    }
}

@code {
    [Parameter]
    public Guid ProjectId { get; set; }

    private WorkItemViewModel? _project;
    private bool _loading = true;
    private string _activeView = "board"; // Default to Kanban board
    private ConnectionState _connectionState = ConnectionState.Connected;

    protected override async Task OnInitializedAsync()
    {
        _connectionState = AppState.ConnectionState;
        AppState.OnStateChanged += HandleStateChanged;
        AppState.OnConnectionStateChanged += HandleConnectionChanged;
    }

    protected override async Task OnParametersSetAsync()
    {
        await LoadProjectAsync();
    }

    private async Task LoadProjectAsync()
    {
        _loading = true;
        StateHasChanged();

        try
        {
            // Load project data
            await AppState.LoadProjectAsync(ProjectId);

            // Get the project work item
            var project = AppState.WorkItems.GetById(ProjectId);
            _project = project is not null ? ViewModelFactory.Create(project) : null;
        }
        catch (Exception ex)
        {
            NotificationService.Notify(
                NotificationSeverity.Error,
                "Error",
                $"Failed to load project: {ex.Message}");
            _project = null;
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }

    private void HandleWorkItemSelected(WorkItemViewModel item)
    {
        NavigationManager.NavigateTo($"/workitem/{item.Id}");
    }

    private async Task ShowCreateDialog()
    {
        await DialogService.OpenAsync<WorkItemDialog>(
            "Create Work Item",
            new Dictionary<string, object>
            {
                { "ProjectId", ProjectId }
            },
            new DialogOptions { Width = "600px" });
    }

    private void HandleStateChanged()
    {
        // Refresh project data
        var project = AppState.WorkItems.GetById(ProjectId);
        if (project is not null)
        {
            _project = ViewModelFactory.Create(project);
            InvokeAsync(StateHasChanged);
        }
    }

    private void HandleConnectionChanged(ConnectionState state)
    {
        _connectionState = state;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        AppState.OnStateChanged -= HandleStateChanged;
        AppState.OnConnectionStateChanged -= HandleConnectionChanged;
    }
}
```

**Purpose**: Project detail page with toggle between list view and Kanban board view. Shows project header with create button. Routes to work item detail on selection.

---

### Step 5: Create WorkItemDetail Page

**Create**: `ProjectManagement.Wasm/Pages/WorkItemDetail.razor`

```razor
@page "/workitem/{WorkItemId:guid}"
@using ProjectManagement.Core.Models
@using ProjectManagement.Core.ViewModels
@inject AppState AppState
@inject ViewModelFactory ViewModelFactory
@inject DialogService DialogService
@inject NotificationService NotificationService
@inject NavigationManager NavigationManager
@implements IDisposable

<PageTitle>@(_workItem?.Title ?? "Work Item") - Agile Board</PageTitle>

@if (_loading)
{
    <ProjectDetailSkeleton RowCount="3" />
}
else if (_workItem is null)
{
    <EmptyState Icon="error"
                Title="Work Item Not Found"
                Description="The work item you're looking for doesn't exist or has been deleted."
                ActionText="Go Back"
                OnAction="@(() => NavigationManager.NavigateTo("/"))" />
}
else
{
    @* Breadcrumbs *@
    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span class="separator">/</span>
        @if (_project is not null)
        {
            <a href="@($"/project/{_project.Id}")">@_project.Title</a>
            <span class="separator">/</span>
        }
        <span class="current">@_workItem.Title</span>
    </nav>

    @* Header *@
    <div class="page-header">
        <RadzenStack Orientation="Orientation.Horizontal"
                     AlignItems="AlignItems.Center"
                     Gap="0.75rem">
            <WorkItemTypeIcon Type="@_workItem.ItemType" Size="1.75rem" />
            <div>
                <h1 class="page-title">@_workItem.Title</h1>
                <RadzenStack Orientation="Orientation.Horizontal"
                             Gap="0.5rem"
                             class="mt-1">
                    <WorkItemStatusBadge Status="@_workItem.Status" />
                    <PriorityBadge Priority="@_workItem.Priority" />
                    @if (_workItem.StoryPoints.HasValue)
                    {
                        <RadzenBadge BadgeStyle="BadgeStyle.Info"
                                     Text="@($"{_workItem.StoryPoints} pts")" />
                    }
                </RadzenStack>
            </div>
        </RadzenStack>
        <div class="page-actions">
            <RadzenButton Text="Edit"
                          Icon="edit"
                          ButtonStyle="ButtonStyle.Secondary"
                          Click="@ShowEditDialog"
                          Disabled="@(!_isConnected || _workItem.IsPendingSync)" />
            <RadzenButton Text="Delete"
                          Icon="delete"
                          ButtonStyle="ButtonStyle.Danger"
                          Variant="Variant.Outlined"
                          Click="@HandleDelete"
                          Disabled="@(!_isConnected || _workItem.IsPendingSync)" />
        </div>
    </div>

    @* Content *@
    <RadzenRow Gap="1.5rem">
        @* Main Content *@
        <RadzenColumn Size="12" SizeMD="8">
            <div class="content-card">
                <h2 class="content-card-title">Description</h2>
                @if (string.IsNullOrWhiteSpace(_workItem.Description))
                {
                    <RadzenText class="text-muted">No description provided.</RadzenText>
                }
                else
                {
                    <RadzenText Style="white-space: pre-wrap;">@_workItem.Description</RadzenText>
                }
            </div>

            @* Child Items *@
            @if (_children.Any())
            {
                <div class="content-card mt-4">
                    <div class="content-card-header">
                        <h2 class="content-card-title">Child Items (@_children.Count)</h2>
                    </div>
                    @foreach (var child in _children)
                    {
                        <WorkItemRow Item="@child"
                                     IsConnected="@_isConnected"
                                     OnSelect="@(item => NavigationManager.NavigateTo($"/workitem/{item.Id}"))"
                                     OnEdit="@HandleEditChild"
                                     OnDelete="@HandleDeleteChild" />
                    }
                </div>
            }
        </RadzenColumn>

        @* Sidebar *@
        <RadzenColumn Size="12" SizeMD="4">
            <div class="content-card">
                <h3 class="content-card-title">Details</h3>
                <RadzenStack Gap="1rem">
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Type</RadzenText>
                        <RadzenText>@_workItem.ItemTypeDisplayName</RadzenText>
                    </div>
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Status</RadzenText>
                        <RadzenText>@_workItem.StatusDisplayName</RadzenText>
                    </div>
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Priority</RadzenText>
                        <RadzenText>@_workItem.PriorityDisplayName</RadzenText>
                    </div>
                    @if (_workItem.StoryPoints.HasValue)
                    {
                        <div>
                            <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Story Points</RadzenText>
                            <RadzenText>@_workItem.StoryPoints</RadzenText>
                        </div>
                    }
                    @if (_sprint is not null)
                    {
                        <div>
                            <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Sprint</RadzenText>
                            <RadzenText>@_sprint.Name</RadzenText>
                        </div>
                    }
                    <div class="divider"></div>
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Created</RadzenText>
                        <RadzenText>@_workItem.CreatedAt.ToString("MMM d, yyyy h:mm tt")</RadzenText>
                    </div>
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Updated</RadzenText>
                        <RadzenText>@_workItem.UpdatedAt.ToString("MMM d, yyyy h:mm tt")</RadzenText>
                    </div>
                    <div>
                        <RadzenText TextStyle="TextStyle.Caption" class="text-muted">Version</RadzenText>
                        <RadzenText>@_workItem.Version</RadzenText>
                    </div>
                </RadzenStack>
            </div>
        </RadzenColumn>
    </RadzenRow>
}

@code {
    [Parameter]
    public Guid WorkItemId { get; set; }

    private WorkItemViewModel? _workItem;
    private WorkItemViewModel? _project;
    private SprintViewModel? _sprint;
    private List<WorkItemViewModel> _children = new();
    private bool _loading = true;
    private bool _isConnected = true;

    protected override void OnInitialized()
    {
        _isConnected = AppState.ConnectionState == ConnectionState.Connected;
        AppState.OnStateChanged += HandleStateChanged;
        AppState.OnConnectionStateChanged += HandleConnectionChanged;
    }

    protected override async Task OnParametersSetAsync()
    {
        await LoadWorkItemAsync();
    }

    private async Task LoadWorkItemAsync()
    {
        _loading = true;
        StateHasChanged();

        try
        {
            await Task.Yield();

            var workItem = AppState.WorkItems.GetById(WorkItemId);
            if (workItem is null)
            {
                _workItem = null;
                return;
            }

            _workItem = ViewModelFactory.Create(workItem);

            // Load project
            var project = AppState.WorkItems.GetById(_workItem.ProjectId);
            _project = project is not null ? ViewModelFactory.Create(project) : null;

            // Load sprint if assigned
            if (_workItem.SprintId.HasValue)
            {
                var sprint = AppState.Sprints.GetById(_workItem.SprintId.Value);
                _sprint = sprint is not null ? ViewModelFactory.Create(sprint) : null;
            }
            else
            {
                _sprint = null;
            }

            // Load children
            var children = AppState.WorkItems.GetChildren(WorkItemId);
            _children = ViewModelFactory.CreateMany(children).ToList();
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }

    private async Task ShowEditDialog()
    {
        if (_workItem is null) return;

        var result = await DialogService.OpenAsync<WorkItemDialog>(
            "Edit Work Item",
            new Dictionary<string, object>
            {
                { "WorkItem", _workItem },
                { "ProjectId", _workItem.ProjectId }
            },
            new DialogOptions { Width = "600px" });

        if (result is true)
        {
            await LoadWorkItemAsync();
        }
    }

    private async Task HandleDelete()
    {
        if (_workItem is null) return;

        var hasChildren = _children.Any();
        var message = hasChildren
            ? $"Are you sure you want to delete \"{_workItem.Title}\"? This will also delete {_children.Count} child item(s)."
            : $"Are you sure you want to delete \"{_workItem.Title}\"?";

        var confirmed = await DialogService.Confirm(
            message,
            "Delete Work Item",
            new ConfirmOptions
            {
                OkButtonText = "Delete",
                CancelButtonText = "Cancel"
            });

        if (confirmed == true)
        {
            try
            {
                await AppState.WorkItems.DeleteAsync(_workItem.Id);
                NotificationService.Notify(
                    NotificationSeverity.Success,
                    "Deleted",
                    $"\"{_workItem.Title}\" has been deleted");

                // Navigate back to project or home
                if (_project is not null)
                {
                    NavigationManager.NavigateTo($"/project/{_project.Id}");
                }
                else
                {
                    NavigationManager.NavigateTo("/");
                }
            }
            catch (Exception ex)
            {
                NotificationService.Notify(
                    NotificationSeverity.Error,
                    "Error",
                    ex.Message);
            }
        }
    }

    private async Task HandleEditChild(WorkItemViewModel child)
    {
        var result = await DialogService.OpenAsync<WorkItemDialog>(
            "Edit Work Item",
            new Dictionary<string, object>
            {
                { "WorkItem", child },
                { "ProjectId", child.ProjectId }
            },
            new DialogOptions { Width = "600px" });

        if (result is true)
        {
            await LoadWorkItemAsync();
        }
    }

    private async Task HandleDeleteChild(WorkItemViewModel child)
    {
        var confirmed = await DialogService.Confirm(
            $"Are you sure you want to delete \"{child.Title}\"?",
            "Delete Work Item",
            new ConfirmOptions
            {
                OkButtonText = "Delete",
                CancelButtonText = "Cancel"
            });

        if (confirmed == true)
        {
            try
            {
                await AppState.WorkItems.DeleteAsync(child.Id);
                NotificationService.Notify(
                    NotificationSeverity.Success,
                    "Deleted",
                    $"\"{child.Title}\" has been deleted");
                await LoadWorkItemAsync();
            }
            catch (Exception ex)
            {
                NotificationService.Notify(
                    NotificationSeverity.Error,
                    "Error",
                    ex.Message);
            }
        }
    }

    private void HandleStateChanged()
    {
        _ = LoadWorkItemAsync();
    }

    private void HandleConnectionChanged(ConnectionState state)
    {
        _isConnected = state == ConnectionState.Connected;
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        AppState.OnStateChanged -= HandleStateChanged;
        AppState.OnConnectionStateChanged -= HandleConnectionChanged;
    }
}
```

**Purpose**: Work item detail page showing description, child items, and metadata sidebar. Supports edit/delete operations with proper navigation and breadcrumbs.

---

### Step 6: Update _Imports.razor

**Modify**: `ProjectManagement.Wasm/_Imports.razor`

Add these imports:

```razor
@using System.Net.Http
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Web.Virtualization
@using Microsoft.AspNetCore.Components.WebAssembly.Http
@using Microsoft.Extensions.Logging
@using Microsoft.JSInterop
@using Radzen
@using Radzen.Blazor
@using ProjectManagement.Core.Models
@using ProjectManagement.Core.Interfaces
@using ProjectManagement.Core.Exceptions
@using ProjectManagement.Core.ViewModels
@using ProjectManagement.Services.State
@using ProjectManagement.Components.Shared
@using ProjectManagement.Components.WorkItems
@using ProjectManagement.Wasm
@using ProjectManagement.Wasm.Layout
@using ProjectManagement.Wasm.Shared
```

**Purpose**: Global imports for all Razor components in the WASM project. Includes Radzen, Core models, Components, and local namespaces.

---

### Step 7: Update index.html

**Modify**: `ProjectManagement.Wasm/wwwroot/index.html`

Add these CSS links to the `<head>` section:

```html
<link href="_content/ProjectManagement.Components/css/app.css" rel="stylesheet" />
<link href="_content/ProjectManagement.Components/css/work-items.css" rel="stylesheet" />
<link href="_content/ProjectManagement.Components/css/kanban.css" rel="stylesheet" />
<link href="_content/ProjectManagement.Components/css/layout.css" rel="stylesheet" />
```

**Purpose**: Load RCL CSS files from the Components library. These CSS files were created in Session 30.1 and contain the design system.

---

### Step 8: Update Program.cs

**Modify**: `ProjectManagement.Wasm/Program.cs`

Ensure these services are registered:

```csharp
// ViewModelFactory (from Session 30.1)
builder.Services.AddScoped<ViewModelFactory>();

// Radzen components (should already exist)
builder.Services.AddRadzenComponents();
```

**Purpose**: Register ViewModelFactory for dependency injection in pages. Radzen services should already be registered from earlier session.

**Note**: AppState, WorkItemStore, SprintStore, and other services should already be registered from Session 30.3.

---

## Session 30.5 Completion Checklist

After completing all steps:

- [ ] `dotnet build ProjectManagement.Wasm` passes
- [ ] All three pages load without errors
- [ ] Navigation menu displays correctly
- [ ] Home page shows empty state or project list
- [ ] ProjectDetail page toggles between list and board views
- [ ] WorkItemDetail page shows details and child items
- [ ] Breadcrumbs work on all pages
- [ ] Edit/delete buttons are enabled when connected
- [ ] Dialog opens when creating/editing work items
- [ ] CSS files are loaded (inspect browser DevTools)

### Files Created (5)

- `ProjectManagement.Wasm/Layout/NavMenu.razor`
- `ProjectManagement.Wasm/Layout/MainLayout.razor`
- `ProjectManagement.Wasm/Pages/Home.razor`
- `ProjectManagement.Wasm/Pages/ProjectDetail.razor`
- `ProjectManagement.Wasm/Pages/WorkItemDetail.razor`

### Files Modified (3)

- `ProjectManagement.Wasm/_Imports.razor`
- `ProjectManagement.Wasm/wwwroot/index.html`
- `ProjectManagement.Wasm/Program.cs`

---

## Next Session

**Session 30.6** will implement:
- Comprehensive integration tests
- End-to-end testing of full workflows
- Performance validation
- Final polish and verification

**Total for Session 30**: After 30.6, we'll have:
- 41 production files
- 70+ passing tests
- Complete working WASM application
- Ready for Session 40 (Sprints & Comments)
