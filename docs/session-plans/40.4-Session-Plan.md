# Session 40.4: Frontend Integration & Desktop Mode

**Parent Plan**: `40-Session-Plan-Production.md`
**Prerequisite**: Session 40.3 completed
**Target**: ~35k tokens
**Actual**: ~140k tokens (400% over due to extensive troubleshooting)
**Status**: ✅ 95% Complete (2026-01-21) - One minor Radzen fix needed

---

## Scope

This session integrates the Blazor WASM frontend with the Tauri desktop shell:

1. **Enhanced Blazor index.html** - Minimal desktop detection (not separate HTML)
2. **JavaScript Interop** - Thin bridge to Tauri APIs (~30 lines)
3. **C# Desktop Services** - Configuration, status polling, and reconnection handling
4. **WebSocket Integration** - Dynamic URL discovery and reconnection support
5. **Build Configuration** - Tauri publish pipeline with correct paths

---

## Learning Objectives

After completing this session, you will understand:
- Blazor WASM startup customization
- JavaScript-to-.NET interop patterns
- Desktop-specific configuration injection
- WebSocket reconnection strategies for embedded servers

---

## Prerequisites Check

Before starting, verify Session 40.3 is complete:

```bash
cd desktop/src-tauri && cargo build
```

Verify `cargo tauri dev` launches the application window.

---

## Implementation Order

### Step 1: Create Desktop Frontend HTML

This HTML file provides a polished startup experience with progress indicators and error handling.

**Create**: `desktop/frontend/index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Manager</title>
    <base href="/" />
    <link href="_content/ProjectManagement.Components/css/app.css" rel="stylesheet" />
    <link href="_content/Radzen.Blazor/css/material-base.css" rel="stylesheet" />
    <style>
        :root {
            --pm-primary: #3b82f6;
            --pm-error: #ef4444;
            --pm-success: #22c55e;
            --pm-bg: #f8fafc;
            --pm-text: #1e293b;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--pm-bg);
            color: var(--pm-text);
        }

        /* === Startup Screen === */
        .startup-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 2rem;
        }

        .startup-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
            color: var(--pm-primary);
        }

        .startup-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .startup-status {
            color: #64748b;
            margin-bottom: 1.5rem;
        }

        /* === Progress Bar === */
        .progress-container {
            width: 240px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 100%;
            background: var(--pm-primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-bar.indeterminate {
            width: 30%;
            animation: indeterminate 1.5s ease-in-out infinite;
        }

        @keyframes indeterminate {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }

        /* === Startup Steps === */
        .startup-steps {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.875rem;
        }

        .startup-steps li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0;
            color: #94a3b8;
        }

        .startup-steps li.complete { color: var(--pm-success); }
        .startup-steps li.active { color: var(--pm-primary); }
        .startup-steps li.error { color: var(--pm-error); }

        /* === Error Screen === */
        .error-container {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 2rem;
            max-width: 400px;
        }

        .error-container.visible { display: flex; }

        .error-icon {
            width: 48px;
            height: 48px;
            color: var(--pm-error);
            margin-bottom: 1rem;
        }

        .error-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .error-message {
            color: #64748b;
            margin-bottom: 1rem;
        }

        .error-hint {
            font-size: 0.875rem;
            color: #94a3b8;
            margin-bottom: 1.5rem;
        }

        /* === Buttons === */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background 0.15s;
        }

        .btn-primary {
            background: var(--pm-primary);
            color: white;
        }

        .btn-primary:hover { background: #2563eb; }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--pm-text);
        }

        .btn-secondary:hover { background: #cbd5e1; }

        .btn-group {
            display: flex;
            gap: 0.75rem;
        }

        /* === Reconnection Overlay === */
        #reconnect-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            align-items: center;
            gap: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Startup Screen -->
        <div class="startup-screen" id="startup-screen">
            <svg class="startup-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" />
                <path d="M9 9h6M9 13h6M9 17h4" />
            </svg>

            <h1 class="startup-title">Project Manager</h1>
            <p class="startup-status" id="status-text">Initializing...</p>

            <div class="progress-container">
                <div class="progress-bar indeterminate" id="progress-bar"></div>
            </div>

            <ul class="startup-steps" id="startup-steps">
                <li id="step-init" class="active">
                    <span>●</span> Initializing application
                </li>
                <li id="step-server">
                    <span>○</span> Starting server
                </li>
                <li id="step-health">
                    <span>○</span> Checking health
                </li>
                <li id="step-ui">
                    <span>○</span> Loading interface
                </li>
            </ul>
        </div>

        <!-- Error Screen -->
        <div class="error-container" id="error-container">
            <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 8v4M12 16h.01" />
            </svg>

            <h2 class="error-title" id="error-title">Unable to Start</h2>
            <p class="error-message" id="error-message">An error occurred while starting the application.</p>
            <p class="error-hint" id="error-hint">Please try restarting the application.</p>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="retryStartup()">
                    Try Again
                </button>
                <button class="btn btn-secondary" onclick="exportLogs()">
                    Export Logs
                </button>
            </div>
        </div>
    </div>

    <script src="_framework/blazor.webassembly.js" autostart="false"></script>
    <script>
        // Access Tauri APIs
        const { invoke } = window.__TAURI__.core;
        const { listen } = window.__TAURI__.event;

        let wsUrl = null;
        let startupAttempts = 0;
        const maxAttempts = 3;

        // === UI Helper Functions ===

        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            if (!step) return;

            step.classList.remove('active', 'complete', 'error');
            if (status) step.classList.add(status);

            const icon = step.querySelector('span');
            if (status === 'complete') icon.textContent = '✓';
            else if (status === 'error') icon.textContent = '✗';
            else if (status === 'active') icon.textContent = '●';
            else icon.textContent = '○';
        }

        function setStatus(text) {
            document.getElementById('status-text').textContent = text;
        }

        function showError(title, message, hint) {
            document.getElementById('startup-screen').style.display = 'none';
            document.getElementById('error-container').classList.add('visible');
            document.getElementById('error-title').textContent = title;
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-hint').textContent = hint || '';
        }

        // === Server Polling ===

        async function pollServerStatus() {
            const maxPolls = 60; // 30 seconds
            const pollInterval = 500;

            for (let i = 0; i < maxPolls; i++) {
                try {
                    const status = await invoke('get_server_status');

                    if (status.state === 'running') {
                        wsUrl = status.websocket_url;
                        return true;
                    } else if (status.state === 'failed') {
                        throw new Error(status.error || 'Server failed to start');
                    }

                    setStatus(`Starting server... (${Math.floor(i * pollInterval / 1000)}s)`);
                } catch (e) {
                    console.error('Status poll error:', e);
                }

                await new Promise(r => setTimeout(r, pollInterval));
            }

            throw new Error('Server startup timeout');
        }

        // === Main Startup Sequence ===

        async function startApp() {
            startupAttempts++;

            try {
                // Step 1: Initialize
                updateStep('step-init', 'complete');
                updateStep('step-server', 'active');
                setStatus('Starting server...');

                // Step 2: Wait for server
                await pollServerStatus();
                updateStep('step-server', 'complete');
                updateStep('step-health', 'active');
                setStatus('Checking server health...');

                // Step 3: Verify health
                const status = await invoke('get_server_status');
                if (status.health?.status !== 'healthy') {
                    throw new Error('Server health check failed');
                }
                updateStep('step-health', 'complete');
                updateStep('step-ui', 'active');
                setStatus('Loading interface...');

                // Step 4: Configure and start Blazor
                window.PM_CONFIG = {
                    serverUrl: wsUrl,
                    isDesktop: true
                };

                // Set progress to determinate
                const progressBar = document.getElementById('progress-bar');
                progressBar.classList.remove('indeterminate');
                progressBar.style.width = '100%';

                await Blazor.start({
                    environment: 'Production'
                });

                updateStep('step-ui', 'complete');

                // Hide startup screen after slight delay
                setTimeout(() => {
                    document.getElementById('startup-screen').style.display = 'none';
                }, 300);

            } catch (error) {
                console.error('Startup error:', error);

                if (startupAttempts < maxAttempts) {
                    setStatus(`Retrying... (attempt ${startupAttempts + 1}/${maxAttempts})`);
                    await new Promise(r => setTimeout(r, 2000));
                    return startApp();
                }

                // Mark failed step
                const steps = ['step-init', 'step-server', 'step-health', 'step-ui'];
                for (const step of steps) {
                    const el = document.getElementById(step);
                    if (el?.classList.contains('active')) {
                        updateStep(step, 'error');
                        break;
                    }
                }

                showError(
                    'Unable to Start',
                    error.message || 'An unexpected error occurred.',
                    'Try restarting the application or check the logs for more details.'
                );
            }
        }

        async function retryStartup() {
            document.getElementById('error-container').classList.remove('visible');
            document.getElementById('startup-screen').style.display = 'flex';

            // Reset steps
            ['step-init', 'step-server', 'step-health', 'step-ui'].forEach(id => {
                updateStep(id, '');
            });
            updateStep('step-init', 'active');

            startupAttempts = 0;
            await startApp();
        }

        async function exportLogs() {
            try {
                const path = await invoke('export_diagnostics');
                alert(`Diagnostics exported to: ${path}`);
            } catch (e) {
                alert(`Failed to export: ${e}`);
            }
        }

        // === WebSocket Reconnection Handling ===

        let wasRunning = false;
        let reconnectAttempts = 0;

        async function handleServerStateChange(state) {
            console.log('Server state:', state);

            const isRunning = state.includes('Running');
            const isRestarting = state.includes('Restarting');
            const isFailed = state.includes('Failed');

            if (isRunning && wasRunning === false && reconnectAttempts > 0) {
                console.log('Server recovered, triggering WebSocket reconnection...');

                try {
                    const newWsUrl = await invoke('get_websocket_url');
                    if (newWsUrl && newWsUrl !== wsUrl) {
                        console.log('WebSocket URL changed:', wsUrl, '->', newWsUrl);
                        wsUrl = newWsUrl;
                        window.PM_CONFIG.serverUrl = newWsUrl;
                    }

                    // Trigger reconnection in Blazor
                    if (window.DotNet) {
                        try {
                            await DotNet.invokeMethodAsync(
                                'ProjectManagement.Services',
                                'TriggerReconnect',
                                newWsUrl
                            );
                        } catch (e) {
                            console.warn('Could not trigger Blazor reconnect:', e);
                            window.location.reload();
                        }
                    }

                    reconnectAttempts = 0;
                    hideReconnectionOverlay();
                } catch (e) {
                    console.error('Failed to get new WebSocket URL:', e);
                }
            }

            if (isRestarting) {
                reconnectAttempts++;
                console.log(`Server restarting (attempt ${reconnectAttempts})`);
                showReconnectionOverlay(reconnectAttempts);
            }

            if (isFailed) {
                console.error('Server failed');
                showError(
                    'Server Error',
                    'The server has stopped unexpectedly.',
                    'Try restarting the application or check the logs.'
                );
            }

            wasRunning = isRunning;
        }

        function showReconnectionOverlay(attempt) {
            let overlay = document.getElementById('reconnect-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'reconnect-overlay';
                document.body.appendChild(overlay);
            }

            overlay.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                    <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                <span>Reconnecting to server (attempt ${attempt})...</span>
            `;
            overlay.style.display = 'flex';
        }

        function hideReconnectionOverlay() {
            const overlay = document.getElementById('reconnect-overlay');
            if (overlay) overlay.style.display = 'none';
        }

        // === Event Listeners ===

        listen('server-ready', () => {
            console.log('Server ready event received');
            hideReconnectionOverlay();
        });

        listen('server-error', (event) => {
            console.error('Server error:', event.payload);
        });

        listen('server-state-changed', (event) => {
            handleServerStateChange(event.payload);
        });

        // Start the application
        startApp();
    </script>
</body>
</html>
```

---

### Step 2: Create JavaScript Interop

**Create**: `frontend/ProjectManagement.Wasm/wwwroot/js/desktop-interop.js`

```javascript
// Desktop mode interop for Tauri
window.DesktopInterop = {
    /**
     * Get desktop configuration.
     * PM_CONFIG is set by the Tauri desktop host before Blazor loads.
     */
    getConfig: function() {
        if (window.PM_CONFIG && window.PM_CONFIG.isDesktop) {
            return {
                serverUrl: window.PM_CONFIG.serverUrl,
                isDesktop: true
            };
        }
        return { serverUrl: null, isDesktop: false };
    },

    /**
     * Check if running in desktop mode.
     */
    isDesktop: function() {
        return window.PM_CONFIG?.isDesktop === true;
    },

    /**
     * Get the current server URL.
     */
    getServerUrl: function() {
        return window.PM_CONFIG?.serverUrl || null;
    }
};
```

---

### Step 3: Create Desktop Configuration Service

**Create**: `frontend/ProjectManagement.Services/Desktop/DesktopConfigService.cs`

```csharp
using Microsoft.JSInterop;
using System.Text.Json.Serialization;

namespace ProjectManagement.Services.Desktop;

/// <summary>
/// Configuration received from Tauri desktop host.
/// </summary>
public record DesktopConfig
{
    [JsonPropertyName("serverUrl")]
    public string? ServerUrl { get; init; }

    [JsonPropertyName("isDesktop")]
    public bool IsDesktop { get; init; }
}

/// <summary>
/// Service for detecting and configuring desktop mode.
/// </summary>
public class DesktopConfigService
{
    private readonly IJSRuntime _jsRuntime;
    private DesktopConfig? _cachedConfig;

    public DesktopConfigService(IJSRuntime jsRuntime)
    {
        _jsRuntime = jsRuntime;
    }

    /// <summary>
    /// Get desktop configuration. Returns null if not in desktop mode.
    /// </summary>
    public async Task<DesktopConfig?> GetConfigAsync()
    {
        if (_cachedConfig != null)
            return _cachedConfig;

        try
        {
            _cachedConfig = await _jsRuntime.InvokeAsync<DesktopConfig>(
                "DesktopInterop.getConfig"
            );

            return _cachedConfig?.IsDesktop == true ? _cachedConfig : null;
        }
        catch
        {
            // JS interop not available or DesktopInterop not defined
            return null;
        }
    }

    /// <summary>
    /// Check if running in desktop mode.
    /// </summary>
    public async Task<bool> IsDesktopModeAsync()
    {
        var config = await GetConfigAsync();
        return config?.IsDesktop == true;
    }

    /// <summary>
    /// Get the server URL for desktop mode.
    /// </summary>
    public async Task<string?> GetServerUrlAsync()
    {
        var config = await GetConfigAsync();
        return config?.ServerUrl;
    }
}

/// <summary>
/// Static reconnect handler callable from JavaScript.
/// </summary>
public static class DesktopReconnectHandler
{
    private static Func<string, Task>? _reconnectCallback;

    /// <summary>
    /// Set the callback to invoke when reconnection is needed.
    /// </summary>
    public static void SetReconnectCallback(Func<string, Task> callback)
    {
        _reconnectCallback = callback;
    }

    /// <summary>
    /// Called from JavaScript when the server restarts and URL may have changed.
    /// </summary>
    [JSInvokable("TriggerReconnect")]
    public static async Task TriggerReconnect(string newUrl)
    {
        if (_reconnectCallback != null)
        {
            await _reconnectCallback(newUrl);
        }
    }
}
```

---

### Step 4: Update WASM Configuration

**Update**: `frontend/ProjectManagement.Wasm/wwwroot/appsettings.json`

```json
{
  "WebSocket": {
    "ServerUrl": "ws://127.0.0.1:8000/ws",
    "HeartbeatInterval": "00:00:30",
    "HeartbeatTimeout": "00:01:00",
    "RequestTimeout": "00:00:30",
    "ReconnectMaxAttempts": 10,
    "ReconnectBaseDelay": "00:00:01",
    "ReconnectMaxDelay": "00:00:30"
  },
  "Desktop": {
    "Enabled": false
  }
}
```

---

### Step 5: Update Program.cs for Desktop Mode

**Update**: `frontend/ProjectManagement.Wasm/Program.cs`

Add desktop mode detection and configuration override:

```csharp
using Microsoft.AspNetCore.Components.Web;
using Microsoft.AspNetCore.Components.WebAssembly.Hosting;
using ProjectManagement.Services;
using ProjectManagement.Services.Desktop;
using ProjectManagement.Wasm;

var builder = WebAssemblyHostBuilder.CreateDefault(args);
builder.RootComponents.Add<App>("#app");
builder.RootComponents.Add<HeadOutlet>("head::after");

// Register desktop config service early
builder.Services.AddScoped<DesktopConfigService>();

// Build initial host to check for desktop mode
var host = builder.Build();
var jsRuntime = host.Services.GetRequiredService<IJSRuntime>();
var desktopConfigService = host.Services.GetRequiredService<DesktopConfigService>();

// Check for desktop mode
var desktopConfig = await desktopConfigService.GetConfigAsync();

if (desktopConfig != null && !string.IsNullOrEmpty(desktopConfig.ServerUrl))
{
    Console.WriteLine($"Desktop mode detected, server URL: {desktopConfig.ServerUrl}");

    // Rebuild with desktop-specific configuration
    builder = WebAssemblyHostBuilder.CreateDefault(args);
    builder.RootComponents.Add<App>("#app");
    builder.RootComponents.Add<HeadOutlet>("head::after");

    builder.Services.AddScoped<DesktopConfigService>();

    // Override WebSocket configuration for desktop
    builder.Services.Configure<WebSocketOptions>(options =>
    {
        options.ServerUrl = desktopConfig.ServerUrl;
        // Desktop mode can use shorter timeouts since server is local
        options.HeartbeatInterval = TimeSpan.FromSeconds(15);
        options.HeartbeatTimeout = TimeSpan.FromSeconds(30);
    });

    // Register all services
    builder.Services.AddProjectManagementServices();

    host = builder.Build();
}
else
{
    Console.WriteLine("Standard WASM mode - using config from appsettings.json");

    // Standard WASM mode - use config from appsettings.json
    builder.Services.AddProjectManagementServices();

    host = builder.Build();
}

// Setup reconnect handler for desktop mode
var wsService = host.Services.GetService<IWebSocketService>();
if (wsService != null)
{
    DesktopReconnectHandler.SetReconnectCallback(async (newUrl) =>
    {
        Console.WriteLine($"Reconnecting to: {newUrl}");
        await wsService.ReconnectAsync(newUrl);
    });
}

await host.RunAsync();
```

---

### Step 6: Add Desktop Interop Script Reference

**Update**: `frontend/ProjectManagement.Wasm/wwwroot/index.html`

Add the script reference before Blazor loads:

```html
<!-- Add before blazor.webassembly.js -->
<script src="js/desktop-interop.js"></script>
```

---

## Session 40.4 Completion Status ✅

**Completed**: 2026-01-21
**Result**: Desktop app fully functional with active WebSocket connection

### Files Created (7)

| File | Purpose | Lines | Status |
|------|---------|-------|--------|
| `frontend/ProjectManagement.Wasm/wwwroot/index.html` | Enhanced with desktop detection | ~60 | ✅ Complete |
| `frontend/ProjectManagement.Wasm/wwwroot/js/desktop-interop.js` | Thin Tauri API bridge | 30 | ✅ Complete |
| `frontend/ProjectManagement.Services/Desktop/DesktopConfig.cs` | Config model | 22 | ✅ Complete |
| `frontend/ProjectManagement.Services/Desktop/ServerStatus.cs` | Status model | 33 | ✅ Complete |
| `frontend/ProjectManagement.Services/Desktop/HealthStatus.cs` | Health model | 15 | ✅ Complete |
| `frontend/ProjectManagement.Services/Desktop/ServerStateChangeHandler.cs` | Event handler | 35 | ✅ Complete |
| `frontend/ProjectManagement.Services/Desktop/DesktopConfigService.cs` | Main desktop service | 188 | ✅ Complete |

### Files Modified (4)

| File | Change | Status |
|------|--------|--------|
| `frontend/ProjectManagement.Services/WebSocket/WebSocketClient.cs` | Added `ReconnectAsync()` method | ✅ Complete |
| `frontend/ProjectManagement.Wasm/Program.cs` | Two-phase init with desktop detection | ✅ Complete |
| `frontend/ProjectManagement.Wasm/ProjectManagement.Wasm.csproj` | Fixed PublishDir & fingerprinting | ✅ Complete |
| `desktop/src-tauri/tauri.conf.json` | Build config with correct paths | ✅ Complete |

### Remaining Issues (1)

| Issue | File | Fix Required | Priority |
|-------|------|--------------|----------|
| RadzenNotification Position property | `frontend/ProjectManagement.Wasm/Layout/MainLayout.razor` | Remove `Position="NotificationPosition.TopRight"` | Low |

### Verification Results

- ✅ `dotnet build frontend/ProjectManagement.Wasm` - Clean build
- ✅ `cargo tauri dev` - App launches successfully
- ✅ Desktop mode detected
- ✅ Embedded server starts on port 8001
- ✅ Frontend connects via WebSocket
- ✅ UI renders ("Welcome to Agile Board" visible)
- ✅ Connection status shows "Connected"
- ⚠️ RadzenNotification error (non-blocking)

---

## Key Concepts Covered

1. **Minimal JavaScript Philosophy**: Keep JS thin (30 lines), do heavy lifting in C#

2. **Two-Phase Blazor Initialization**: Build temp host for detection, rebuild with correct config

3. **Configuration Override**: Desktop mode dynamically overrides appsettings.json

4. **Case-Sensitive State Handling**: Rust returns lowercase "running", C# needs case-insensitive comparison

5. **Asset Fingerprinting**: Disabled for desktop builds to avoid mismatch with static references

6. **Tauri Build Pipeline**: `beforeDevCommand` with `cwd` for correct working directory

## Key Deviations from Original Plan

1. **No separate desktop/frontend/index.html**: Enhanced existing Blazor index.html instead
2. **Separated models**: Split DesktopConfigService into 7 files following C# conventions
3. **Added ReconnectAsync**: WebSocketClient needed URL update capability
4. **Build configuration fixes**: Tauri config needed `cwd` and `frontendDist: "../frontend/wwwroot"`
5. **Publish directory fix**: Set `PublishDir` in .csproj, disabled `WasmFingerprintAssets`

---

## Testing Desktop Mode

1. Build the frontend:
```bash
cd frontend
dotnet publish ProjectManagement.Wasm -c Release -o ../desktop/frontend
```

2. Build and run Tauri:
```bash
cd desktop/src-tauri
cargo tauri dev
```

3. Verify:
- Startup screen shows with progress steps
- Server starts (check tray icon)
- Blazor UI loads
- WebSocket connects (check console)

---

## Next Session

**Session 40.5** will implement:
- Build scripts for all platforms
- CI/CD pipeline with GitHub Actions
- Unit and integration tests
- Manual test checklist
