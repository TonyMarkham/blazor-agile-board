# Session 70.2: Frontend Polish - Toast Notifications & Activity UI (Production)

**Parent Plan**: `70-Session-Plan.md`
**Target**: ~45-55k tokens
**Prerequisites**: Session 70.1 complete, `just check` passes
**Status**: ⏳ Pending

---

## Scope

This session implements production-grade frontend polish aligned to current repo patterns:

1. **Real-time Subscriptions** (Part 0) - Fix WebSocket subscribe/unsubscribe so broadcasts deliver
2. **Activity Log Models** (Part 1) - C# models matching proto
3. **Proto Converters** (Part 2) - ActivityLog serialization/deserialization
4. **WebSocket Client Methods** (Part 3) - Activity query + real-time event
5. **Activity Feed Components** (Part 4) - Feed, item, skeleton + styles
6. **Toast Notification Service** (Part 5) - Queueing + action toasts + deterministic timing
7. **Operation Spinner** (Part 6) - Blocking overlay with ARIA
8. **Tests** (Part 7) - Subscription tests, activity UI tests, deterministic toast tests

---

## Prerequisites Check

Before starting, verify:

```bash
just check          # All code compiles
just test-frontend  # Existing frontend tests pass
```

Ensure these exist:
- `GetActivityLogRequest`, `ActivityLogEntry`, `ActivityLogList`, `ActivityLogCreated` in `proto/messages.proto`
- Backend handler `handle_get_activity_log` implemented (Session 70.1)

---

## Implementation Order

### Part 0: Real-time Subscription Correctness

#### Step 0.1: Implement Subscribe/Unsubscribe in WebSocket Client

**File**: `frontend/ProjectManagement.Services/WebSocket/WebSocketClient.cs`

Replace the TODO methods with real messages (no response expected):

```csharp
public async Task SubscribeAsync(IEnumerable<Guid> projectIds, CancellationToken ct = default)
{
    ThrowIfDisposed();
    EnsureConnected();

    var ids = projectIds?.Where(id => id != Guid.Empty).Distinct().ToList() ?? new List<Guid>();
    if (ids.Count == 0) return;

    lock (_subscribedProjects)
    {
        foreach (var id in ids)
            _subscribedProjects.Add(id);
    }

    var message = new Pm.WebSocketMessage
    {
        MessageId = Guid.NewGuid().ToString(),
        Timestamp = DateTimeOffset.UtcNow.ToUnixTimeSeconds(),
        Subscribe = new Pm.Subscribe()
    };

    message.Subscribe.ProjectIds.AddRange(ids.Select(id => id.ToString()));

    await SendMessageAsync(message, ct);
    _logger.LogDebug("Subscribed to projects: {ProjectIds}", string.Join(", ", ids));
}

public async Task UnsubscribeAsync(IEnumerable<Guid> projectIds, CancellationToken ct = default)
{
    ThrowIfDisposed();
    EnsureConnected();

    var ids = projectIds?.Where(id => id != Guid.Empty).Distinct().ToList() ?? new List<Guid>();
    if (ids.Count == 0) return;

    lock (_subscribedProjects)
    {
        foreach (var id in ids)
            _subscribedProjects.Remove(id);
    }

    var message = new Pm.WebSocketMessage
    {
        MessageId = Guid.NewGuid().ToString(),
        Timestamp = DateTimeOffset.UtcNow.ToUnixTimeSeconds(),
        Unsubscribe = new Pm.Unsubscribe()
    };

    message.Unsubscribe.ProjectIds.AddRange(ids.Select(id => id.ToString()));

    await SendMessageAsync(message, ct);
    _logger.LogDebug("Unsubscribed from projects: {ProjectIds}", string.Join(", ", ids));
}
```

#### Step 0.2: Subscription Tests (MockWebSocketConnection)

**Create**: `frontend/ProjectManagement.Services.Tests/WebSocket/WebSocketClientSubscriptionTests.cs`

```csharp
using FluentAssertions;
using Microsoft.Extensions.Logging.Abstractions;
using Microsoft.Extensions.Options;
using ProjectManagement.Core.Validation;
using Pm = ProjectManagement.Core.Proto;
using ProjectManagement.Services.Tests.Mocks;
using ProjectManagement.Services.WebSocket;
using Xunit;

namespace ProjectManagement.Services.Tests.WebSocket;

public class WebSocketClientSubscriptionTests
{
    private static WebSocketClient CreateClient(MockWebSocketConnection connection)
    {
        var options = Options.Create(new WebSocketOptions { ServerUrl = "ws://localhost:8000/ws" });
        return new WebSocketClient(
            options,
            NullLogger<WebSocketClient>.Instance,
            NullLoggerFactory.Instance,
            new CreateWorkItemRequestValidator(),
            new UpdateWorkItemRequestValidator(),
            () => connection);
    }

    [Fact]
    public async Task SubscribeAsync_SendsSubscribeMessage()
    {
        var conn = new MockWebSocketConnection();
        var client = CreateClient(conn);
        await client.ConnectAsync();

        var id = Guid.NewGuid();
        await client.SubscribeAsync(new[] { id });

        var msg = Pm.WebSocketMessage.Parser.ParseFrom(conn.SentMessages.Last());
        msg.PayloadCase.Should().Be(Pm.WebSocketMessage.PayloadOneofCase.Subscribe);
        msg.Subscribe.ProjectIds.Should().Contain(id.ToString());
    }

    [Fact]
    public async Task UnsubscribeAsync_SendsUnsubscribeMessage()
    {
        var conn = new MockWebSocketConnection();
        var client = CreateClient(conn);
        await client.ConnectAsync();

        var id = Guid.NewGuid();
        await client.UnsubscribeAsync(new[] { id });

        var msg = Pm.WebSocketMessage.Parser.ParseFrom(conn.SentMessages.Last());
        msg.PayloadCase.Should().Be(Pm.WebSocketMessage.PayloadOneofCase.Unsubscribe);
        msg.Unsubscribe.ProjectIds.Should().Contain(id.ToString());
    }
}
```

**Verification**: `just test-cs-services`

---

### Part 1: Activity Log Models

#### Step 1.1: Create Activity Log Model

**Create**: `frontend/ProjectManagement.Core/Models/ActivityLog.cs`

```csharp
namespace ProjectManagement.Core.Models;

/// <summary>
/// Activity log entry tracking changes to entities
/// </summary>
public sealed record ActivityLog
{
    public Guid Id { get; init; }
    public string EntityType { get; init; } = string.Empty;
    public Guid EntityId { get; init; }
    public string Action { get; init; } = string.Empty;
    public string? FieldName { get; init; }
    public string? OldValue { get; init; }
    public string? NewValue { get; init; }
    public Guid UserId { get; init; }
    public DateTime Timestamp { get; init; }
    public string? Comment { get; init; }
}
```

#### Step 1.2: Create Activity Log Page Model

**Create**: `frontend/ProjectManagement.Core/Models/ActivityLogPage.cs`

```csharp
namespace ProjectManagement.Core.Models;

/// <summary>
/// Paginated list of activity log entries
/// </summary>
public sealed record ActivityLogPage
{
    public IReadOnlyList<ActivityLog> Entries { get; init; } = Array.Empty<ActivityLog>();
    public int TotalCount { get; init; }
    public bool HasMore { get; init; }
}
```

#### Step 1.3: Create Activity Log Request Model

**Create**: `frontend/ProjectManagement.Core/Models/GetActivityLogRequest.cs`

```csharp
namespace ProjectManagement.Core.Models;

/// <summary>
/// Request for activity log entries
/// </summary>
public sealed record GetActivityLogRequest
{
    public string EntityType { get; init; } = string.Empty;
    public Guid EntityId { get; init; }
    public int Limit { get; init; } = 50;
    public int Offset { get; init; } = 0;
}
```

**Verification**: `just build-cs-core`

---

### Part 2: Proto Converters

#### Step 2.1: Add Activity Log Converters

**File**: `frontend/ProjectManagement.Core/Converters/ProtoConverter.cs`

Add these methods to the `ProtoConverter` class:

```csharp
// Activity Log Converters

public static Proto.GetActivityLogRequest ToProto(GetActivityLogRequest request)
{
    ArgumentNullException.ThrowIfNull(request);

    return new Proto.GetActivityLogRequest
    {
        EntityType = request.EntityType,
        EntityId = request.EntityId.ToString(),
        Limit = request.Limit,
        Offset = request.Offset,
    };
}

public static ActivityLog FromProto(Proto.ActivityLogEntry proto)
{
    ArgumentNullException.ThrowIfNull(proto);

    return new ActivityLog
    {
        Id = Guid.Parse(proto.Id),
        EntityType = proto.EntityType,
        EntityId = Guid.Parse(proto.EntityId),
        Action = proto.Action,
        FieldName = proto.FieldName,
        OldValue = proto.OldValue,
        NewValue = proto.NewValue,
        UserId = Guid.Parse(proto.UserId),
        Timestamp = DateTimeOffset.FromUnixTimeSeconds(proto.Timestamp).UtcDateTime,
        Comment = proto.Comment,
    };
}

public static ActivityLogPage FromProto(Proto.ActivityLogList proto)
{
    ArgumentNullException.ThrowIfNull(proto);

    var entries = proto.Entries
        .Select(FromProto)
        .ToList()
        .AsReadOnly();

    return new ActivityLogPage
    {
        Entries = entries,
        TotalCount = proto.TotalCount,
        HasMore = proto.HasMore,
    };
}
```

#### Step 2.2: Add Converter Tests (Optional Fields)

**File**: `frontend/ProjectManagement.Core.Tests/Converters/ProtoConverterTests.cs`

```csharp
[Fact]
public void ActivityLogEntry_FromProto_HandlesOptionalFields()
{
    var proto = new Proto.ActivityLogEntry
    {
        Id = Guid.NewGuid().ToString(),
        EntityType = "work_item",
        EntityId = Guid.NewGuid().ToString(),
        Action = "created",
        UserId = Guid.NewGuid().ToString(),
        Timestamp = DateTimeOffset.UtcNow.ToUnixTimeSeconds(),
    };

    var model = ProtoConverter.FromProto(proto);

    model.FieldName.Should().BeNull();
    model.OldValue.Should().BeNull();
    model.NewValue.Should().BeNull();
    model.Comment.Should().BeNull();
}
```

**Verification**: `just test-cs-core`

---

### Part 3: WebSocket Client Methods

#### Step 3.1: Add Activity Methods to Interface

**File**: `frontend/ProjectManagement.Core/Interfaces/IWebSocketClient.cs`

Add:

```csharp
Task<ActivityLogPage> GetActivityLogAsync(
    string entityType,
    Guid entityId,
    int limit = 50,
    int offset = 0,
    CancellationToken cancellationToken = default);

event Action<ActivityLog>? OnActivityLogCreated;
```

#### Step 3.2: Implement Activity Query + Broadcast

**File**: `frontend/ProjectManagement.Services/WebSocket/WebSocketClient.cs`

Add event:

```csharp
public event Action<ActivityLog>? OnActivityLogCreated;
```

Add method (inline validation to match current repo style):

```csharp
public async Task<ActivityLogPage> GetActivityLogAsync(
    string entityType,
    Guid entityId,
    int limit = 50,
    int offset = 0,
    CancellationToken cancellationToken = default)
{
    ThrowIfDisposed();
    EnsureConnected();

    if (string.IsNullOrWhiteSpace(entityType))
        throw new ArgumentException("EntityType is required", nameof(entityType));
    if (entityId == Guid.Empty)
        throw new ArgumentException("EntityId is required", nameof(entityId));
    if (limit is < 1 or > 100)
        throw new ArgumentOutOfRangeException(nameof(limit), "Limit must be 1-100");
    if (offset < 0)
        throw new ArgumentOutOfRangeException(nameof(offset), "Offset must be >= 0");

    var request = new GetActivityLogRequest
    {
        EntityType = entityType,
        EntityId = entityId,
        Limit = limit,
        Offset = offset,
    };

    var message = new Pm.WebSocketMessage
    {
        MessageId = Guid.NewGuid().ToString(),
        Timestamp = DateTimeOffset.UtcNow.ToUnixTimeSeconds(),
        GetActivityLogRequest = ProtoConverter.ToProto(request),
    };

    var response = await SendRequestAsync(message, cancellationToken);

    if (response.PayloadCase == Pm.WebSocketMessage.PayloadOneofCase.Error)
        throw new ServerRejectedException(response.Error.Code, response.Error.Message, response.Error.Field);

    if (response.PayloadCase != Pm.WebSocketMessage.PayloadOneofCase.ActivityLogList)
        throw new InvalidOperationException($"Unexpected response type: {response.PayloadCase}");

    return ProtoConverter.FromProto(response.ActivityLogList);
}
```

Add to `HandleBroadcastEvent`:

```csharp
case Pm.WebSocketMessage.PayloadOneofCase.ActivityLogCreated:
    var entry = ProtoConverter.FromProto(message.ActivityLogCreated.Entry);
    OnActivityLogCreated?.Invoke(entry);
    break;
```

#### Step 3.3: Activity Method Tests (Validation + Error)

**Create**: `frontend/ProjectManagement.Services.Tests/WebSocket/WebSocketClientActivityTests.cs`

```csharp
using FluentAssertions;
using Microsoft.Extensions.Logging.Abstractions;
using Microsoft.Extensions.Options;
using ProjectManagement.Core.Validation;
using ProjectManagement.Services.Tests.Mocks;
using ProjectManagement.Services.WebSocket;
using Xunit;

namespace ProjectManagement.Services.Tests.WebSocket;

public class WebSocketClientActivityTests
{
    private static WebSocketClient CreateClient(MockWebSocketConnection connection)
    {
        var options = Options.Create(new WebSocketOptions { ServerUrl = "ws://localhost:8000/ws" });
        return new WebSocketClient(
            options,
            NullLogger<WebSocketClient>.Instance,
            NullLoggerFactory.Instance,
            new CreateWorkItemRequestValidator(),
            new UpdateWorkItemRequestValidator(),
            () => connection);
    }

    [Fact]
    public async Task GetActivityLogAsync_ThrowsOnInvalidLimit()
    {
        var conn = new MockWebSocketConnection();
        var client = CreateClient(conn);
        await client.ConnectAsync();

        var act = () => client.GetActivityLogAsync("work_item", Guid.NewGuid(), limit: 999);
        await act.Should().ThrowAsync<ArgumentOutOfRangeException>();
    }

    [Fact]
    public async Task GetActivityLogAsync_ThrowsOnEmptyEntityType()
    {
        var conn = new MockWebSocketConnection();
        var client = CreateClient(conn);
        await client.ConnectAsync();

        var act = () => client.GetActivityLogAsync("", Guid.NewGuid());
        await act.Should().ThrowAsync<ArgumentException>();
    }

    [Fact]
    public async Task GetActivityLogAsync_ThrowsOnEmptyEntityId()
    {
        var conn = new MockWebSocketConnection();
        var client = CreateClient(conn);
        await client.ConnectAsync();

        var act = () => client.GetActivityLogAsync("work_item", Guid.Empty);
        await act.Should().ThrowAsync<ArgumentException>();
    }
}
```

**Verification**: `just test-cs-services`

---

### Part 4: Activity Feed Components

#### Step 4.1: Create ActivityFeed Component

**Create**: `frontend/ProjectManagement.Components/Activity/ActivityFeed.razor`

Create the component with the following implementation:

```razor
@using Microsoft.AspNetCore.Components.Web
@using ProjectManagement.Core.Models
@using ProjectManagement.Core.Interfaces
@using Radzen
@implements IAsyncDisposable
@inject IWebSocketClient Client
@inject ILogger<ActivityFeed> Logger

<div class="activity-feed"
     role="feed"
     aria-label="Activity history"
     aria-busy="@_loading"
     tabindex="0"
     @onkeydown="HandleKeyDown">

    @if (_error != null)
    {
        <div class="activity-error" role="alert">
            <RadzenIcon Icon="error" />
            <span>@_error</span>
            <RadzenButton Text="Retry" Click="@LoadInitial" Size="ButtonSize.Small" Variant="Variant.Text" />
        </div>
    }
    else if (_loading && _entries.Count == 0)
    {
        <ActivityFeedSkeleton Rows="@PageSize" />
    }
    else if (_entries.Count == 0)
    {
        <div class="empty-state" role="status">
            <RadzenIcon Icon="history" Style="font-size: 48px; opacity: 0.3;" />
            <p>No activity yet</p>
            <small>Changes will appear here</small>
        </div>
    }
    else
    {
        <div class="activity-list" role="list">
            @foreach (var entry in _entries)
            {
                <ActivityItem Entry="@entry" @key="entry.Id" />
            }
        </div>

        @if (_hasMore)
        {
            <div class="load-more-container">
                <LoadingButton Text="Load more"
                               LoadingText="Loading..."
                               OnClick="@LoadMore"
                               IsBusy="@_loadingMore"
                               Disabled="@_loadingMore" />
            </div>
        }
    }
</div>

@code {
    [Parameter, EditorRequired]
    public string EntityType { get; set; } = default!;

    [Parameter, EditorRequired]
    public Guid EntityId { get; set; }

    [Parameter]
    public int PageSize { get; set; } = 20;

    private readonly List<ActivityLog> _entries = new();
    private bool _loading, _loadingMore, _hasMore;
    private string? _error;
    private int _offset;
    private Guid _currentEntityId;
    private bool _disposed;
    private CancellationTokenSource? _loadCts;

    protected override async Task OnParametersSetAsync()
    {
        if (_currentEntityId != EntityId)
        {
            _currentEntityId = EntityId;
            _entries.Clear();
            _offset = 0;
            _error = null;
            await LoadInitial();
        }
    }

    protected override void OnInitialized()
    {
        Client.OnActivityLogCreated += HandleActivityCreated;
    }

    private async Task LoadInitial()
    {
        _loadCts?.Cancel();
        _loadCts?.Dispose();
        _loadCts = new CancellationTokenSource();

        await LoadInitialCore(_loadCts.Token);
    }

    private async Task LoadInitialCore(CancellationToken ct)
    {
        _loading = true;
        _error = null;
        StateHasChanged();

        try
        {
            var page = await Client.GetActivityLogAsync(EntityType, EntityId, PageSize, 0, ct);
            _entries.Clear();
            _entries.AddRange(page.Entries);
            _hasMore = page.HasMore;
            _offset = PageSize;
        }
        catch (OperationCanceledException)
        {
            // Cancelled by user or component disposal
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to load activity for {EntityType} {EntityId}", EntityType, EntityId);
            _error = "Failed to load activity. Click to retry.";
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }

    private async Task LoadMore()
    {
        if (_loadingMore) return;

        _loadingMore = true;
        StateHasChanged();

        _loadCts?.Cancel();
        _loadCts?.Dispose();
        _loadCts = new CancellationTokenSource();

        try
        {
            var page = await Client.GetActivityLogAsync(EntityType, EntityId, PageSize, _offset, _loadCts.Token);
            _entries.AddRange(page.Entries);
            _hasMore = page.HasMore;
            _offset += PageSize;
        }
        catch (OperationCanceledException)
        {
            // Cancelled by user or component disposal
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Failed to load more activity");
        }
        finally
        {
            _loadingMore = false;
            StateHasChanged();
        }
    }

    private void HandleActivityCreated(ActivityLog activity)
    {
        if (activity.EntityType == EntityType && activity.EntityId == EntityId)
        {
            _entries.Insert(0, activity);
            InvokeAsync(StateHasChanged);
        }
    }

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key is "r" or "R")
            _ = LoadInitial();
    }

    public ValueTask DisposeAsync()
    {
        if (_disposed) return ValueTask.CompletedTask;
        _disposed = true;
        Client.OnActivityLogCreated -= HandleActivityCreated;
        _loadCts?.Cancel();
        _loadCts?.Dispose();
        return ValueTask.CompletedTask;
    }
}
```

#### Step 4.2: Create ActivityItem Component

**Create**: `frontend/ProjectManagement.Components/Activity/ActivityItem.razor`

```razor
@using System.Globalization

<article class="activity-item" role="listitem" aria-label="@AriaLabel" tabindex="0">
    <div class="activity-icon" aria-hidden="true">
        @switch (Entry.Action)
        {
            case "created":
                <RadzenIcon Icon="add_circle" Style="color: var(--rz-success, #4caf50)" />
                break;
            case "updated":
                <RadzenIcon Icon="edit" Style="color: var(--rz-info, #2196f3)" />
                break;
            case "deleted":
                <RadzenIcon Icon="delete" Style="color: var(--rz-danger, #f44336)" />
                break;
            default:
                <RadzenIcon Icon="history" />
                break;
        }
    </div>

    <div class="activity-content">
        <span class="activity-action">@FormatAction()</span>

        @if (!string.IsNullOrEmpty(Entry.FieldName))
        {
            <div class="activity-change" aria-label="@ChangeAriaLabel">
                <span class="field-name">@Entry.FieldName:</span>
                <span class="old-value" aria-label="Old value">@(Entry.OldValue ?? "(empty)")</span>
                <RadzenIcon Icon="arrow_forward" aria-hidden="true" Style="font-size: 14px;" />
                <span class="new-value" aria-label="New value">@(Entry.NewValue ?? "(empty)")</span>
            </div>
        }

        <time class="activity-timestamp"
              datetime="@Entry.Timestamp.ToString("O")"
              title="@Entry.Timestamp.ToLocalTime().ToString("f")">
            @FormatRelativeTime(Entry.Timestamp)
        </time>
    </div>
</article>

@code {
    [Parameter, EditorRequired]
    public ActivityLog Entry { get; set; } = default!;

    private string AriaLabel =>
        $"{Entry.Action} {Entry.FieldName ?? "item"} {FormatRelativeTime(Entry.Timestamp)}";

    private string ChangeAriaLabel =>
        $"Changed {Entry.FieldName} from {Entry.OldValue ?? "empty"} to {Entry.NewValue ?? "empty"}";

    private string FormatAction() => Entry.Action switch
    {
        "created" => "Created",
        "updated" => $"Updated {Entry.FieldName}",
        "deleted" => "Deleted",
        _ => Entry.Action
    };

    private string FormatRelativeTime(DateTime timestamp)
    {
        var span = DateTime.UtcNow - timestamp;
        return span.TotalSeconds switch
        {
            < 60 => "just now",
            < 3600 => $"{(int)span.TotalMinutes}m ago",
            < 86400 => $"{(int)span.TotalHours}h ago",
            < 604800 => $"{(int)span.TotalDays}d ago",
            _ => timestamp.ToLocalTime().ToString("MMM d", CultureInfo.CurrentCulture)
        };
    }
}
```

#### Step 4.3: Create Activity Feed Skeleton

**Create**: `frontend/ProjectManagement.Components/Activity/ActivityFeedSkeleton.razor`

```razor
<div class="activity-skeleton" aria-busy="true" aria-label="Loading activity">
    @for (int i = 0; i < Rows; i++)
    {
        <div class="skeleton-item" @key="i">
            <div class="skeleton-icon"></div>
            <div class="skeleton-content">
                <div class="skeleton-text skeleton-text-title"></div>
                <div class="skeleton-text skeleton-text-subtitle"></div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public int Rows { get; set; } = 5;
}
```

#### Step 4.4: Add Activity Styles

**File**: `frontend/ProjectManagement.Components/wwwroot/css/app.css`

Add the following CSS:

```css
/* Activity Feed */
.activity-feed {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 12px 0;
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.activity-item {
    display: grid;
    grid-template-columns: 32px 1fr;
    gap: 12px;
    padding: 12px;
    background: var(--rz-base-background-color, #fff);
    border: 1px solid var(--rz-border-color, #e6e6e6);
    border-radius: 10px;
}

.activity-item:focus-visible {
    outline: 2px solid var(--rz-primary, #2563eb);
    outline-offset: 2px;
}

.activity-action {
    font-weight: 600;
}

.activity-change {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    color: var(--rz-text-secondary, #6b7280);
}

.activity-timestamp {
    display: block;
    margin-top: 6px;
    font-size: 0.8rem;
    color: var(--rz-text-secondary, #6b7280);
}

.activity-error {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border: 1px solid var(--rz-danger, #f44336);
    border-radius: 8px;
    background: rgba(244, 67, 54, 0.06);
}

.load-more-container {
    display: flex;
    justify-content: center;
    margin-top: 8px;
}

/* Activity Skeleton */
.activity-skeleton {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.skeleton-item {
    display: grid;
    grid-template-columns: 32px 1fr;
    gap: 12px;
    padding: 12px;
    border: 1px solid var(--rz-border-color, #e6e6e6);
    border-radius: 10px;
    background: var(--rz-base-background-color, #fff);
}

.skeleton-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #e5e7eb;
}

.skeleton-text {
    height: 10px;
    background: #e5e7eb;
    border-radius: 6px;
    margin-bottom: 8px;
}

.skeleton-text-title { width: 55%; }
.skeleton-text-subtitle { width: 35%; }
```

**Verification**: `just build-cs-components`

---

### Part 5: Toast Notification Service

#### Step 5.1: Create Toast Service Interface

**Create**: `frontend/ProjectManagement.Services/Notifications/IToastService.cs`

```csharp
namespace ProjectManagement.Services.Notifications;

/// <summary>
/// Toast notification service for user feedback
/// </summary>
public interface IToastService
{
    void ShowSuccess(string message, string? title = null, int? durationMs = null);
    void ShowError(string message, string? title = null, int? durationMs = null);
    void ShowWarning(string message, string? title = null, int? durationMs = null);
    void ShowInfo(string message, string? title = null, int? durationMs = null);

    void ShowWithAction(string message, string actionText, Func<Task> onAction, int durationMs = 5000);

    void Clear();

    int ActiveCount { get; }

    IReadOnlyList<ActionToastRequest> ActionToasts { get; }
    event Action? OnActionToastsChanged;
    void DismissActionToast(Guid id);
}
```

#### Step 5.2: Add Action Toast Model

**Create**: `frontend/ProjectManagement.Services/Notifications/ActionToastRequest.cs`

```csharp
namespace ProjectManagement.Services.Notifications;

/// <summary>
/// Represents a toast with an action button (e.g., "Undo")
/// </summary>
public sealed record ActionToastRequest
{
    public Guid Id { get; init; } = Guid.NewGuid();
    public string Message { get; init; } = string.Empty;
    public string ActionText { get; init; } = string.Empty;
    public Func<Task> OnAction { get; init; } = () => Task.CompletedTask;
    public int DurationMs { get; init; } = 5000;
}
```

#### Step 5.3: Deterministic Scheduler Abstraction

**Create**: `frontend/ProjectManagement.Services/Notifications/IToastScheduler.cs`

```csharp
namespace ProjectManagement.Services.Notifications;

public interface IToastScheduler
{
    Task DelayAsync(int delayMs, CancellationToken ct = default);
}
```

**Create**: `frontend/ProjectManagement.Services/Notifications/ToastScheduler.cs`

```csharp
namespace ProjectManagement.Services.Notifications;

public sealed class ToastScheduler : IToastScheduler
{
    public Task DelayAsync(int delayMs, CancellationToken ct = default) => Task.Delay(delayMs, ct);
}
```

#### Step 5.4: Implement ToastService (Use Scheduler)

**Create**: `frontend/ProjectManagement.Services/Notifications/ToastService.cs`

```csharp
using Microsoft.Extensions.Logging;
using Radzen;

namespace ProjectManagement.Services.Notifications;

/// <summary>
/// Production-grade toast service with queue management
/// </summary>
public sealed class ToastService : IToastService, IDisposable
{
    private readonly NotificationService _radzen;
    private readonly ILogger<ToastService> _logger;
    private readonly IToastScheduler _scheduler;
    private readonly object _lock = new();

    public static class Defaults
    {
        public const int SuccessDurationMs = 3000;
        public const int ErrorDurationMs = 5000;
        public const int WarningDurationMs = 4000;
        public const int InfoDurationMs = 3000;
        public const int ActionDurationMs = 5000;
        public const int MaxConcurrentToasts = 3;
        public const int MaxActionToasts = 2;
    }

    private int _activeCount;
    public int ActiveCount => _activeCount;

    private readonly List<ActionToastRequest> _actionToasts = new();
    public IReadOnlyList<ActionToastRequest> ActionToasts => _actionToasts.AsReadOnly();
    public event Action? OnActionToastsChanged;

    public ToastService(NotificationService radzen, ILogger<ToastService> logger, IToastScheduler scheduler)
    {
        _radzen = radzen ?? throw new ArgumentNullException(nameof(radzen));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _scheduler = scheduler ?? throw new ArgumentNullException(nameof(scheduler));
    }

    public void ShowSuccess(string message, string? title = null, int? durationMs = null)
    {
        ArgumentNullException.ThrowIfNull(message);
        Show(NotificationSeverity.Success, message, title ?? "Success", durationMs ?? Defaults.SuccessDurationMs);
    }

    public void ShowError(string message, string? title = null, int? durationMs = null)
    {
        ArgumentNullException.ThrowIfNull(message);
        _logger.LogWarning("User error displayed: {Message}", message);

        _radzen.Notify(new NotificationMessage
        {
            Severity = NotificationSeverity.Error,
            Summary = title ?? "Error",
            Detail = message,
            Duration = durationMs ?? Defaults.ErrorDurationMs,
            CloseOnClick = true,
        });
    }

    public void ShowWarning(string message, string? title = null, int? durationMs = null)
    {
        ArgumentNullException.ThrowIfNull(message);
        Show(NotificationSeverity.Warning, message, title ?? "Warning", durationMs ?? Defaults.WarningDurationMs);
    }

    public void ShowInfo(string message, string? title = null, int? durationMs = null)
    {
        ArgumentNullException.ThrowIfNull(message);
        Show(NotificationSeverity.Info, message, title ?? "Info", durationMs ?? Defaults.InfoDurationMs);
    }

    public void ShowWithAction(string message, string actionText, Func<Task> onAction, int durationMs = 5000)
    {
        ArgumentNullException.ThrowIfNull(message);
        ArgumentNullException.ThrowIfNull(actionText);
        ArgumentNullException.ThrowIfNull(onAction);

        ActionToastRequest request;
        lock (_lock)
        {
            if (_actionToasts.Count >= Defaults.MaxActionToasts)
            {
                _logger.LogDebug("Action toast suppressed (queue full): {Message}", message);
                return;
            }

            request = new ActionToastRequest
            {
                Message = message,
                ActionText = actionText,
                OnAction = onAction,
                DurationMs = durationMs
            };
            _actionToasts.Add(request);
        }

        OnActionToastsChanged?.Invoke();
    }

    public void DismissActionToast(Guid id)
    {
        lock (_lock)
        {
            var index = _actionToasts.FindIndex(t => t.Id == id);
            if (index >= 0)
                _actionToasts.RemoveAt(index);
        }

        OnActionToastsChanged?.Invoke();
    }

    public void Clear()
    {
        lock (_lock)
        {
            _activeCount = 0;
            _actionToasts.Clear();
        }

        OnActionToastsChanged?.Invoke();
    }

    private void Show(NotificationSeverity severity, string message, string title, int durationMs)
    {
        lock (_lock)
        {
            if (_activeCount >= Defaults.MaxConcurrentToasts)
            {
                _logger.LogDebug("Toast suppressed (queue full): {Message}", message);
                return;
            }
            _activeCount++;
        }

        _radzen.Notify(new NotificationMessage
        {
            Severity = severity,
            Summary = title,
            Detail = message,
            Duration = durationMs,
            CloseOnClick = true,
        });

        _ = DecrementAfterDelay(durationMs);
    }

    private async Task DecrementAfterDelay(int delayMs)
    {
        await _scheduler.DelayAsync(delayMs).ConfigureAwait(false);
        lock (_lock)
        {
            _activeCount = Math.Max(0, _activeCount - 1);
        }
    }

    public void Dispose()
    {
        Clear();
    }
}
```

#### Step 5.5: Action Toast Host Component

**Create**: `frontend/ProjectManagement.Components/Shared/ActionToastHost.razor`

```razor
@implements IDisposable
@inject ProjectManagement.Services.Notifications.IToastService Toasts

<div class="action-toast-host" aria-live="polite" aria-atomic="true">
    @foreach (var toast in Toasts.ActionToasts)
    {
        <div class="action-toast" role="status">
            <span>@toast.Message</span>
            <div class="action-toast-buttons">
                <RadzenButton Text="@toast.ActionText"
                              Size="ButtonSize.Small"
                              Click="@(() => HandleAction(toast))" />
                <RadzenButton Icon="close"
                              Size="ButtonSize.Small"
                              ButtonStyle="ButtonStyle.Light"
                              Click="@(() => Toasts.DismissActionToast(toast.Id))" />
            </div>
        </div>
    }
</div>

@code {
    protected override void OnInitialized()
    {
        Toasts.OnActionToastsChanged += HandleActionToastsChanged;
    }

    private async Task HandleAction(ActionToastRequest toast)
    {
        await toast.OnAction();
        Toasts.DismissActionToast(toast.Id);
    }

    private void HandleActionToastsChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Toasts.OnActionToastsChanged -= HandleActionToastsChanged;
    }
}
```

**Add CSS**: `frontend/ProjectManagement.Components/wwwroot/css/app.css`

```css
/* Action Toast Host */
.action-toast-host {
    position: fixed;
    bottom: 24px;
    right: 24px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
}

.action-toast {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px 14px;
    min-width: 260px;
    background: var(--rz-base-background-color, #fff);
    border: 1px solid var(--rz-border-color, #e6e6e6);
    border-radius: 10px;
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
}

.action-toast-buttons {
    display: inline-flex;
    gap: 6px;
}
```

#### Step 5.6: Register Toast Services

**File**: `frontend/ProjectManagement.Wasm/Program.cs`

```csharp
builder.Services.AddScoped<IToastService, ToastService>();
builder.Services.AddScoped<IToastScheduler, ToastScheduler>();
```

#### Step 5.7: Add Toast Host to Layout

**File**: `frontend/ProjectManagement.Wasm/Layout/MainLayout.razor`

```razor
<ActionToastHost />
```

#### Step 5.8: Toast Tests (Deterministic)

**Create**: `frontend/ProjectManagement.Services.Tests/Notifications/ToastServiceTests.cs`

```csharp
using FluentAssertions;
using Microsoft.Extensions.Logging.Abstractions;
using Moq;
using ProjectManagement.Services.Notifications;
using Radzen;
using Xunit;

namespace ProjectManagement.Services.Tests.Notifications;

public class ToastServiceTests
{
    private sealed class FakeToastScheduler : IToastScheduler
    {
        private readonly Queue<TaskCompletionSource<bool>> _pending = new();

        public Task DelayAsync(int delayMs, CancellationToken ct = default)
        {
            var tcs = new TaskCompletionSource<bool>(TaskCreationOptions.RunContinuationsAsynchronously);
            if (ct.CanBeCanceled)
                ct.Register(() => tcs.TrySetCanceled(ct));
            _pending.Enqueue(tcs);
            return tcs.Task;
        }

        public void CompleteNext()
        {
            if (_pending.Count == 0) return;
            _pending.Dequeue().TrySetResult(true);
        }
    }

    private static (ToastService Sut, Mock<NotificationService> Radzen, FakeToastScheduler Scheduler) Create()
    {
        var radzen = new Mock<NotificationService>();
        var scheduler = new FakeToastScheduler();
        var sut = new ToastService(radzen.Object, NullLogger<ToastService>.Instance, scheduler);
        return (sut, radzen, scheduler);
    }

    [Fact]
    public void ShowSuccess_RespectsQueueLimit()
    {
        var (sut, radzen, _) = Create();

        for (int i = 0; i < ToastService.Defaults.MaxConcurrentToasts + 1; i++)
            sut.ShowSuccess($"Message {i}");

        radzen.Verify(r => r.Notify(It.IsAny<NotificationMessage>()),
            Times.Exactly(ToastService.Defaults.MaxConcurrentToasts));
    }

    [Fact]
    public void ShowError_BypassesQueueLimit()
    {
        var (sut, radzen, _) = Create();

        for (int i = 0; i < ToastService.Defaults.MaxConcurrentToasts; i++)
            sut.ShowSuccess($"Message {i}");

        sut.ShowError("Critical");

        radzen.Verify(r => r.Notify(It.IsAny<NotificationMessage>()),
            Times.Exactly(ToastService.Defaults.MaxConcurrentToasts + 1));
    }

    [Fact]
    public void ActionToast_AddsAndDismisses()
    {
        var (sut, _, _) = Create();

        sut.ShowWithAction("Undo delete", "Undo", () => Task.CompletedTask);
        sut.ActionToasts.Should().HaveCount(1);

        var id = sut.ActionToasts.Single().Id;
        sut.DismissActionToast(id);
        sut.ActionToasts.Should().BeEmpty();
    }

    [Fact]
    public async Task ActiveCount_Decrements_WhenSchedulerCompletes()
    {
        var (sut, _, scheduler) = Create();

        sut.ShowSuccess("Saved");
        sut.ActiveCount.Should().Be(1);

        scheduler.CompleteNext();
        await Task.Yield();

        sut.ActiveCount.Should().Be(0);
    }
}
```

**Verification**: `just test-cs-services`

---

### Part 6: Operation Spinner Component

#### Step 6.1: Create OperationSpinner Component

**Create**: `frontend/ProjectManagement.Components/Shared/OperationSpinner.razor`

```razor
<div class="operation-spinner @(IsVisible ? "visible" : "")"
     role="progressbar"
     aria-busy="@IsVisible"
     aria-valuetext="@(Message ?? "Loading")"
     aria-label="@(Message ?? "Loading")">
    <div class="spinner-content">
        <RadzenProgressBarCircular ShowValue="false"
                                   Mode="ProgressBarMode.Indeterminate"
                                   Size="ProgressBarCircularSize.Large" />
        @if (!string.IsNullOrEmpty(Message))
        {
            <span class="spinner-message" aria-live="polite">@Message</span>
        }
        @if (OnCancel.HasDelegate)
        {
            <RadzenButton Text="Cancel"
                          Size="ButtonSize.Small"
                          ButtonStyle="ButtonStyle.Light"
                          Click="@OnCancel" />
        }
    </div>
</div>

@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public string? Message { get; set; }

    [Parameter]
    public EventCallback OnCancel { get; set; }
}
```

**Add CSS**: `frontend/ProjectManagement.Components/wwwroot/css/app.css`

```css
/* Operation Spinner */
.operation-spinner {
    position: fixed;
    inset: 0;
    background: rgba(255, 255, 255, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
}

.operation-spinner.visible {
    display: flex;
}

.spinner-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    background: var(--rz-base-background-color, #fff);
    border: 1px solid var(--rz-border-color, #e6e6e6);
    padding: 18px 20px;
    border-radius: 12px;
}

.spinner-message {
    font-size: 0.95rem;
    color: var(--rz-text-secondary, #6b7280);
}
```

#### Step 6.2: Operation Spinner Tests

**Create**: `frontend/ProjectManagement.Components.Tests/Shared/OperationSpinnerTests.cs`

```csharp
[Fact]
public void OperationSpinner_Renders_WhenVisible()
{
    var cut = Render<OperationSpinner>(p => p.Add(x => x.IsVisible, true));
    cut.Markup.Should().Contain("operation-spinner");
    cut.Markup.Should().Contain("aria-busy=\"True\"");
}
```

**Verification**: `just test-cs-components`

---

#### Step 6.3: Cancellation Pattern (Production-Grade)

**Purpose**: Ensure `OnCancel` actually cancels work via a `CancellationTokenSource`.

**Pattern**: Create a CTS per operation, pass `cts.Token` to async work, and bind
`OnCancel` to `cts.Cancel()`.

**Example (Component using the spinner)**

```razor
@code {
    private CancellationTokenSource? _cts;
    private bool _busy;
    private string? _message;

    private async Task LoadHeavyData()
    {
        _cts?.Dispose();
        _cts = new CancellationTokenSource();
        _busy = true;
        _message = "Loading activity...";

        try
        {
            await _service.LoadAsync(_cts.Token);
        }
        catch (OperationCanceledException)
        {
            // Cancellation is expected - no user-facing error
        }
        finally
        {
            _busy = false;
            _message = null;
        }
    }

    private void CancelLoad()
    {
        _cts?.Cancel();
    }
}
```

```razor
<OperationSpinner IsVisible="@_busy"
                 Message="@_message"
                 OnCancel="@CancelLoad" />
```

**Verification**: trigger the cancel and confirm `OperationCanceledException` is handled.

---

### Part 7: Activity Feed Tests

#### Step 7.1: Activity Feed Component Tests

**Create**: `frontend/ProjectManagement.Components.Tests/Activity/ActivityFeedTests.cs`

```csharp
using Bunit;
using FluentAssertions;
using Microsoft.Extensions.DependencyInjection;
using Moq;
using ProjectManagement.Components.Activity;
using ProjectManagement.Core.Interfaces;
using ProjectManagement.Core.Models;
using Xunit;

namespace ProjectManagement.Components.Tests.Activity;

public class ActivityFeedTests : BunitContext
{
    [Fact]
    public void ActivityFeed_ShowsSkeleton_WhileLoading()
    {
        var client = new Mock<IWebSocketClient>();
        var tcs = new TaskCompletionSource<ActivityLogPage>();

        client.Setup(c => c.GetActivityLogAsync("work_item", It.IsAny<Guid>(), 20, 0, It.IsAny<CancellationToken>()))
            .Returns(tcs.Task);

        Services.AddSingleton(client.Object);
        Services.AddLogging();

        var cut = Render<ActivityFeed>(p => p
            .Add(x => x.EntityType, "work_item")
            .Add(x => x.EntityId, Guid.NewGuid())
            .Add(x => x.PageSize, 20));

        cut.FindAll(".activity-skeleton").Count.Should().Be(1);
    }

    [Fact]
    public void ActivityFeed_ShowsError_OnFailure()
    {
        var client = new Mock<IWebSocketClient>();
        client.Setup(c => c.GetActivityLogAsync("work_item", It.IsAny<Guid>(), 20, 0, It.IsAny<CancellationToken>()))
            .ThrowsAsync(new InvalidOperationException("boom"));

        Services.AddSingleton(client.Object);
        Services.AddLogging();

        var cut = Render<ActivityFeed>(p => p
            .Add(x => x.EntityType, "work_item")
            .Add(x => x.EntityId, Guid.NewGuid())
            .Add(x => x.PageSize, 20));

        cut.WaitForAssertion(() =>
        {
            cut.Markup.Should().Contain("activity-error");
            cut.FindAll("button").Should().NotBeEmpty();
        });
    }

    [Fact]
    public void ActivityFeed_RendersEntries_OnSuccess()
    {
        var client = new Mock<IWebSocketClient>();
        var entityId = Guid.NewGuid();

        client.Setup(c => c.GetActivityLogAsync("work_item", entityId, 20, 0, It.IsAny<CancellationToken>()))
            .ReturnsAsync(new ActivityLogPage
            {
                Entries = new List<ActivityLog>
                {
                    new() { Id = Guid.NewGuid(), EntityType = "work_item", EntityId = entityId, Action = "created", Timestamp = DateTime.UtcNow }
                },
                HasMore = false,
                TotalCount = 1
            });

        Services.AddSingleton(client.Object);
        Services.AddLogging();

        var cut = Render<ActivityFeed>(p => p
            .Add(x => x.EntityType, "work_item")
            .Add(x => x.EntityId, entityId)
            .Add(x => x.PageSize, 20));

        cut.WaitForAssertion(() => cut.FindAll(".activity-item").Count.Should().Be(1));
    }

    [Fact]
    public void ActivityFeed_Refreshes_OnKeyboardShortcut()
    {
        var client = new Mock<IWebSocketClient>();
        var entityId = Guid.NewGuid();

        client.Setup(c => c.GetActivityLogAsync("work_item", entityId, 20, 0, It.IsAny<CancellationToken>()))
            .ReturnsAsync(new ActivityLogPage { Entries = Array.Empty<ActivityLog>(), HasMore = false, TotalCount = 0 });

        Services.AddSingleton(client.Object);
        Services.AddLogging();

        var cut = Render<ActivityFeed>(p => p
            .Add(x => x.EntityType, "work_item")
            .Add(x => x.EntityId, entityId)
            .Add(x => x.PageSize, 20));

        cut.Find(".activity-feed").KeyDown(new Microsoft.AspNetCore.Components.Web.KeyboardEventArgs { Key = "R" });

        client.Verify(c => c.GetActivityLogAsync("work_item", entityId, 20, 0, It.IsAny<CancellationToken>()), Times.AtLeast(2));
    }
}
```

#### Step 7.2: Activity Feed Integration Test

**Create**: `frontend/ProjectManagement.Components.Tests/Activity/ActivityFeedIntegrationTests.cs`

Use a fake `IWebSocketClient` that returns a page and raises `OnActivityLogCreated`:

```csharp
using Bunit;
using FluentAssertions;
using Microsoft.Extensions.DependencyInjection;
using Moq;
using ProjectManagement.Components.Activity;
using ProjectManagement.Core.Interfaces;
using ProjectManagement.Core.Models;
using Xunit;

namespace ProjectManagement.Components.Tests.Activity;

public class ActivityFeedIntegrationTests : BunitContext
{
    [Fact]
    public void ActivityFeed_PrependsEntry_OnRealtimeEvent()
    {
        var client = new Mock<IWebSocketClient>();
        var entityId = Guid.NewGuid();

        client.Setup(c => c.GetActivityLogAsync("work_item", entityId, 20, 0, default))
            .ReturnsAsync(new ActivityLogPage
            {
                Entries = new List<ActivityLog>
                {
                    new() { Id = Guid.NewGuid(), EntityType = "work_item", EntityId = entityId, Action = "created", Timestamp = DateTime.UtcNow }
                },
                HasMore = false,
                TotalCount = 1
            });

        Services.AddSingleton(client.Object);
        Services.AddLogging();

        var cut = Render<ActivityFeed>(p => p
            .Add(x => x.EntityType, "work_item")
            .Add(x => x.EntityId, entityId)
            .Add(x => x.PageSize, 20));

        cut.FindAll(".activity-item").Count.Should().Be(1);

        var incoming = new ActivityLog
        {
            Id = Guid.NewGuid(),
            EntityType = "work_item",
            EntityId = entityId,
            Action = "updated",
            Timestamp = DateTime.UtcNow
        };

        client.Raise(c => c.OnActivityLogCreated += null, incoming);

        cut.WaitForAssertion(() =>
        {
            cut.FindAll(".activity-item").Count.Should().Be(2);
        });
    }
}
```

**Verification**: `just test-cs-components`

---

## Completion Checklist

- [ ] `just test-cs-services` passes (subscriptions + toast tests)
- [ ] `just test-cs-core` passes (converter tests)
- [ ] `just test-cs-components` passes (activity + spinner tests)
- [ ] Activity feed renders without errors
- [ ] Skeleton loader displays during initial load
- [ ] “Load more” button works with pagination
- [ ] Real-time activity updates prepend to list (with subscriptions enabled)
- [ ] Toasts render reliably and tests are deterministic

---

## Files Summary

### Create

- `frontend/ProjectManagement.Services.Tests/WebSocket/WebSocketClientSubscriptionTests.cs`
- `frontend/ProjectManagement.Services.Tests/WebSocket/WebSocketClientActivityTests.cs`
- `frontend/ProjectManagement.Core/Models/ActivityLog.cs`
- `frontend/ProjectManagement.Core/Models/ActivityLogPage.cs`
- `frontend/ProjectManagement.Core/Models/GetActivityLogRequest.cs`
- `frontend/ProjectManagement.Components/Activity/ActivityFeed.razor`
- `frontend/ProjectManagement.Components/Activity/ActivityItem.razor`
- `frontend/ProjectManagement.Components/Activity/ActivityFeedSkeleton.razor`
- `frontend/ProjectManagement.Services/Notifications/IToastService.cs`
- `frontend/ProjectManagement.Services/Notifications/ActionToastRequest.cs`
- `frontend/ProjectManagement.Services/Notifications/IToastScheduler.cs`
- `frontend/ProjectManagement.Services/Notifications/ToastScheduler.cs`
- `frontend/ProjectManagement.Services/Notifications/ToastService.cs`
- `frontend/ProjectManagement.Components/Shared/ActionToastHost.razor`
- `frontend/ProjectManagement.Components/Shared/OperationSpinner.razor`
- `frontend/ProjectManagement.Components.Tests/Shared/OperationSpinnerTests.cs`
- `frontend/ProjectManagement.Components.Tests/Activity/ActivityFeedTests.cs`
- `frontend/ProjectManagement.Components.Tests/Activity/ActivityFeedIntegrationTests.cs`

### Modify

- `frontend/ProjectManagement.Core/Converters/ProtoConverter.cs`
- `frontend/ProjectManagement.Core/Interfaces/IWebSocketClient.cs`
- `frontend/ProjectManagement.Services/WebSocket/WebSocketClient.cs`
- `frontend/ProjectManagement.Components/wwwroot/css/app.css`
- `frontend/ProjectManagement.Wasm/Layout/MainLayout.razor`
- `frontend/ProjectManagement.Wasm/Program.cs`
