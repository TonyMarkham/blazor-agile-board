@using ProjectManagement.Core.Interfaces
@inject IDependencyStore DependencyStore

@if (_isBlocked)
{
    <div class="blocked-indicator" title="@BlockedByText">
        <RadzenIcon Icon="block" />
        <span>Blocked@(_blockedByCount > 1 ? $" ({_blockedByCount})" : "")</span>
    </div>
}

@code {
    [Parameter, EditorRequired] public Guid WorkItemId { get; set; }

    private bool _isBlocked;
    private int _blockedByCount;

    protected override void OnParametersSet()
    {
        _isBlocked = DependencyStore.IsBlocked(WorkItemId);
        _blockedByCount = _isBlocked ? DependencyStore.GetBlockingCount(WorkItemId) : 0;
    }

    private string BlockedByText => _blockedByCount == 1
        ? "Blocked by 1 item"
        : $"Blocked by {_blockedByCount} items";
}